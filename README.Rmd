```{r, echo = FALSE,results = "hide"}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = ">",
  fig.height = 1
)
library(mmre)
```

## Overiew

`R` package to fit two-stare continuous-time discrete-space Markov models with individual level random effects. 
Methodology was developed with [Enrico Pirotta](pirotta.enrico@gmail.com) to assess the effects of exposure 
to Navy sonar on marine mammal movement patterns.

## Installation

To install the `mmre` package run

```{r, eval = FALSE}
devtools::install_github("cmjt/mmre")
library(mmre)
```

All model likelihoods are coded using `TMB`; in oder to compile all `TMB` templates after installation run

```{r, eval = FALSE}
compile.mmre()
```

and to load the templates run 

```{r}
dll.mmre()
```

once in each workspace.

## Example

The `mmre` package contains an example dataset of estimated latitude and longitude locations 
of two individuals on the AUTEC Naval range. The states indicate if an individual was off 
(state = 1) or on (state = 2) range.

```{r, fig.cap = "Estimated tracks on and around the AUTEC Naval range", out.width = '30%',fig.align = "center",echo = FALSE}
knitr::include_graphics("/figure/AUTEC.png")
```


```{r}
data(example)
data <- example
```
To fit a simple two state continuous-time Markov model run

```{r, results = "hide"}
mod.basic <- fit.mmre(data = data,parameters = list(log_baseline = log(c(0.5,0.5))))
```

and to get the estimated transition probability matrix P(t = 1)

```{r}
get.probs(mod.basic,1)
```

To compare the results to the `msm` package run

```{r}
library(msm)
msm.fit <- msm(state ~ time, subject = ID, data = data, qmatrix = rbind(c(0, 0.5), c(0.5, 0)),  
    exacttimes = FALSE)
pmatrix.msm(msm.fit)
```

### Model with individual level random effects

```{r, results = "hide"}
qs <- as.numeric(get.params(mod.basic,FALSE)[,1])
pars <- list(log_baseline = qs,u = matrix(numeric(2*length(table(data$ID))),
      ncol = 2),log_sigma = 0)
mod.basic.re <- fit.mmre(data = data,parameters = pars)
```

```{r}
get.probs(mod.basic.re,1)
```

```{r,  fig.height = 5, fig.width = 10,out.width = "30%",fig.cap = "Individual level random effects"}
show.random(mod.basic.re)
```

